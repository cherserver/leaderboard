# leaderboard

### Для сборки
Выполните make в директории проекта
Моя конфигурация для сборки (на других конфигурациях не тестировал):
Debian 9 64-bit - gcc 6.3.0

Для организации каналов связи была использована библиотека
[SimpleAmqpClient](https://github.com/alanxz/SimpleAmqpClient)

### Решение задачи
Решение задачи содержится в файле leaderboard.cpp, остальные файлы со вспомагательными инструментами.

Перед проектированием решения задачи было сделано следующее предположение:
+ Частота построения таблицы результата имеет порядок не ниже частоты вызова команды user_deal_won

Соответственно, оптимальное решение задачи требует:
+ отсутствия промежуточных (временных) результатов сортировок для таблицы результатов и, в результате, 
+ консистентной таблицы результатов сделок в любой момент времени

Реализованное решение задачи имеет следующую сложность для команд:
+ user_registered - логарифмическую от количества зарегистрированных пользователей (поиск в map)
+ user_deal_won - в худшем случае линейную от количества зарегистрированных пользователей (сортировка таблицы)
+ user_renamed - логарифмическую от количества зарегистрированных пользователей (поиск в map)
+ user_connected - логарифмическую от количества зарегистрированных пользователей (поиск в map)
+ user_disconnected - логарифмическую от количества подключенных пользователей (поиск в map)

Обработка ожидания времени отправки и самого события отправки данных в выходной канал реализованы в отдельном потоке
Отправка данных реализована в отдельном потоке с очередью в целях оптимизации времени отклика системы во входящем канале - никакие сообщения не отправляются напрямую при получении данных

Реализация отправки сообщения при user_connected - поставить в начало списка сообщений, ожидающих отправки

Класс, отвечающий за ведение таблицы результатов: LeaderBoard
Класс, отвечающий за ведение таблицы подключенных пользователей: Reminder
Класс, отвечающий за отправку сообщений из очереди: Producer

*Время в user_deal_won должно быть в формате YYYY-MM-DD hh:mm:ss (2017-09-18 10:45:31)

### Вспомогательные механизмы, не относящиеся напрямую к решению задачи
.h и .cpp -файлы:
+ lb_defines.h - содержит основные константы
+ lb_functions - содержат вспомогательные функции для валидации данных, работы со стоками и датами
+ lb_error - содержат реализацию исключений

+ monitor.cpp - компилируется в бинарник, позволяющий получить данные из выходного канала лидерборда
+ produce_one.cpp - компилируется в бинарник, позволяющий отправить одно сообщение в лидерборд
+ load.cpp - компилируется в бинарник, позволяющий сгенерить нагрузку на входящий канал
